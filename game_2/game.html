<!DOCTYPE html>
<html>
    <head>
        <title>game</title>
        <link rel="stylesheet" type="text/css" href="stylesheet.css"></link>
    </head>
    <body onload="prepareGame()">
        <div style="display:none;">
            <img id="playerIdleImage"
                 src="PlayerCharacter/Idle.png">
            <img id="playerAttackImage"
                 src="PlayerCharacter/Attack2.png">
            
        </div>
        <div class="page">
            <canvas id="canvas1" width="1200" height="600"></canvas>

        </div>

        <div id="winScreen" class="modal">
            <div class="modal-content">
                <p>Thanks for playing! Please take a minute to answer our survey about your experience found <a id="surveyLink" href="">here</a></p>
            </div>
        </div>
        <div id="explanation" class="modal">
            <!-- Modal content -->
            <div class="modal-content explanation">
                <p class="hidden readable-tutorial" id="group1Explanation">Now that you know how it works - please rate on a scale from 1 (very unsure) to 10 (pretty certain) how confident you are that you will choose the right paths.</p>
                <p class="hidden readable-tutorial" id="group2Explanation">
                Before the game begins there will be a practice period where you can get a feeling for moving your cursor around the game board. All paths will be opened and there will be nothing to choose - this is simply movement practice.

                After 15 seconds you will get the option to start the game.
                </p>
                <p class="hidden readable-tutorial" id="group2Explanation2">Now that you know how it works - please rate on a scale from 1 (very unsure) to 10 (pretty certain) how confident you are that you will choose the right paths.</p>

                <div class="hidden" id="confidence" onclick="setConfidence()">
                    <p>not confident</p>
                    <label class="radio_button first" for="confidence1">
                        <span class="confidence_number">1</span>
                        <input type="radio" id="confidence1" name="confidence" value="1">
                    </label>
                    <label class="radio_button" for="confidence2">
                        <span class="confidence_number">2</span>
                        <input type="radio" id="confidence2" name="confidence" value="2">
                    </label>
                    <label class="radio_button" for="confidence3">
                        <span class="confidence_number">3</span>
                        <input type="radio" id="confidence3" name="confidence" value="3">
                    </label>
                    <label class="radio_button" for="confidence4">
                        <span class="confidence_number">4</span>
                        <input type="radio" id="confidence4" name="confidence" value="4">
                    </label>
                    <label class="radio_button" for="confidence5">
                        <span class="confidence_number">5</span>
                        <input type="radio" id="confidence5" name="confidence" value="5">
                    </label>
                    <label class="radio_button" for="confidence6">
                        <span class="confidence_number">6</span>
                        <input type="radio" id="confidence6" name="confidence" value="6">
                    </label>
                    <label class="radio_button" for="confidence7">
                        <span class="confidence_number">7</span>
                        <input type="radio" id="confidence7" name="confidence" value="7">
                    </label>
                    <label class="radio_button" for="confidence8">
                        <span class="confidence_number">8</span>
                        <input type="radio" id="confidence8" name="confidence" value="8">
                    </label>
                    <label class="radio_button" for="confidence9">
                        <span class="confidence_number">9</span>
                        <input type="radio" id="confidence9" name="confidence" value="9">
                    </label>
                    <label class="radio_button" for="confidence10">
                        <span class="confidence_number">10</span>
                        <input type="radio" id="confidence10" name="confidence" value="10">
                    </label>
                    <p>very confident</p>
                </div>
                <button onclick="closeExplanation()">Click here when you're done</button>
            </div>
        </div>
    </body>

    <script>
        /*
        var participantGroup = Math.floor(Math.random() * 2) + 1;
        var ready;
        if(participantGroup == 1) {
            document.getElementById("group1Explanation").style.display = "block";
            document.getElementById("tutorial").style.display = "flex";
            document.getElementById("confidence").style.display = "flex";
            ready = true;
        } else {
            document.getElementById("group2Explanation").style.display = "block";
            document.getElementById("tutorial").style.display = "flex";
            ready = false;
        }

        function setConfidence() {
            var rates = document.getElementsByName("confidence");
            var confidenceValue;
            for(var i = 0; i < rates.length; i++) {
                if(rates[i].checked) {
                    confidenceValue = rates[i].value;
                }
            }
            document.getElementById("surveyLink").href = "https://docs.google.com/forms/d/e/1FAIpQLSfa0Nt08lBclw7pM523cVVIdbdM2qIqvwJjWpevGgleaQ_FtQ/viewform?usp=pp_url&entry.755563979=" + participantGroup + "&entry.146232743=" + confidenceValue;
        }

        function closeExplanation() {
            document.getElementById("explanation").style.display = "none";
            if(!ready) {
                lineSegments.forEach(line => {
                    line.filled = true;
                });
                gameWindow.startCursorCheck();
                window.setTimeout(function(){
                    document.body.style.cursor = "default";
                    window.clearInterval(gameWindow.cursorCheck);
                    document.getElementById("tutorial").style.display = "none";
                    document.getElementById("group2Explanation").style.display = "none";
                    document.getElementById("explanation").style.display = "block";
                    document.getElementById("group2Explanation2").style.display = "block";
                    document.getElementById("confidence").style.display = "flex";
                    ready = true;
                }, 15000);
            } else {
                startGame();
            }
            updateGameArea();
        }
        */


        function startTutorial() {
            window.requestAnimationFrame(gameWindow.draw);
            var playerCharacter = new PlayerCharacter();
            playerCharacter.attack();
        }

        function startPractice() {

        }

        function prepareGame() {
            
        }

        function startGame() {
            
        }

        var drawables = {};
        var gameWindow = {
            stopGame : false,
            canvas1 : document.getElementById("canvas1"),

            start : function() {
                this.context1 = this.canvas1.getContext("2d");

                window.addEventListener('mousemove', function(e) {
                    var canvasRect = gameWindow.canvas1.getBoundingClientRect();
                    gameWindow.mouseX = e.clientX - canvasRect.left;
                    gameWindow.mouseY = e.clientY - canvasRect.top;
                });
            },

            clear : function() {
                this.context1.clearRect(0, 0, this.canvas1.width, this.canvas1.height);
            },

            draw : function() {
                if (gameWindow.stopGame) {
                    return;
                }
                gameWindow.clear();
                for (var key of Object.keys(drawables)) {
                    drawables[key].draw();
                }
                window.requestAnimationFrame(gameWindow.draw);
            }
        }

        function PlayerCharacter() {
            this.animationFrame = 0;
            this.frameSize = {x:231, y:190}
            this.playerImage = document.getElementById("playerIdleImage");
            this.playerAttackImage = document.getElementById("playerAttackImage");
            drawables.player = new Animation(this.playerImage, 100, 100, this.frameSize, {x:400, y:400}, Infinity, "player");

            this.attack = function() {
                animation = getAnimation(this.playerImage, 100, 100, this.frameSize, {x:400, y:400}, Infinity, "player");
                drawables.player = new Animation(this.playerAttackImage, 100, 100, this.frameSize, {x:400, y:400}, 1, "player", animation);
            }
        }

        function getAnimation(image, x, y, frameSize, size, cycles, key, callBack) {
            return function() {
                drawables[key] = new Animation(image, x, y, frameSize, size, cycles, key, callBack);
            };
        }

        function Animation(image, x, y, frameSize, size, cycles, key, callBack) {
            this.image = image;
            this.x = x;
            this.y = y;
            this.frameSize = frameSize;
            this.size = size;
            this.animationFrame = 0;
            this.cycles = cycles;
            this.currentCycle = 0;
            this.key = key;
            this.callBack = callBack;
        
            this.draw = function() {
                //drawImage(image, dx, dy, dxWidth, dyHeight, x, y, xWidth, yHeight)
                gameWindow.context1.drawImage(this.image, this.frameSize.x * Math.floor(this.animationFrame / 6), 0, this.frameSize.x, this.frameSize.y, this.x, this.y, this.size.x, this.size.y);
                this.animationFrame++;
                if (this.animationFrame > this.image.width / this.frameSize.x * 6 - 1) {
                    this.animationFrame = 0;
                    this.currentCycle++;
                }
                if (this.currentCycle >= this.cycles) {
                    delete drawables[key];
                    if (this.callBack != undefined) {
                        this.callBack();
                    }
                }
            }
        }

        gameWindow.start();
        startTutorial();
    </script>
</html>
