<!DOCTYPE html>
<html>
    <head>
        <title>game</title>
        <link rel="stylesheet" type="text/css" href="stylesheet.css"></link>
    </head>
    <body onload="startTutorial()">
        <div style="display:none;">
            
            <img id="playerIdleImage"
                 src="PlayerCharacter/Idle.png">
            <img id="playerAttackImage"
                 src="PlayerCharacter/Attack2.png">

            <img id="wizardIdleImage"
                 src="enemyWizard/Idle.png">
   
            <img id="map2Image"
                 src="map.png">
        </div>
        <div class="page">
            <canvas id="canvas1" width="1200" height="600"></canvas>
            <canvas id="canvas2" width="1200" height="600"></canvas>
            <canvas id="canvas3" width="1200" height="600"></canvas>
        </div>

        <div id="winScreen" class="modal">
            <div class="modal-content">
                <p>Thanks for playing! Please take a minute to answer our survey about your experience found <a id="surveyLink" href="">here</a></p>
            </div>
        </div>
        <div id="explanation" class="modal">
            <!-- Modal content -->
            <div class="modal-content explanation">
                <p class="hidden readable-tutorial" id="group1Explanation">Now that you know how it works - please rate on a scale from 1 (very unsure) to 10 (pretty certain) how confident you are that you will choose the right paths.</p>
                <p class="hidden readable-tutorial" id="group2Explanation">
                Before the game begins there will be a practice period where you can get a feeling for moving your cursor around the game board. All paths will be opened and there will be nothing to choose - this is simply movement practice.

                After 15 seconds you will get the option to start the game.
                </p>
                <p class="hidden readable-tutorial" id="group2Explanation2">Now that you know how it works - please rate on a scale from 1 (very unsure) to 10 (pretty certain) how confident you are that you will choose the right paths.</p>

                <div class="hidden" id="confidence" onclick="setConfidence()">
                    <p>not confident</p>
                    <label class="radio_button first" for="confidence1">
                        <span class="confidence_number">1</span>
                        <input type="radio" id="confidence1" name="confidence" value="1">
                    </label>
                    <label class="radio_button" for="confidence2">
                        <span class="confidence_number">2</span>
                        <input type="radio" id="confidence2" name="confidence" value="2">
                    </label>
                    <label class="radio_button" for="confidence3">
                        <span class="confidence_number">3</span>
                        <input type="radio" id="confidence3" name="confidence" value="3">
                    </label>
                    <label class="radio_button" for="confidence4">
                        <span class="confidence_number">4</span>
                        <input type="radio" id="confidence4" name="confidence" value="4">
                    </label>
                    <label class="radio_button" for="confidence5">
                        <span class="confidence_number">5</span>
                        <input type="radio" id="confidence5" name="confidence" value="5">
                    </label>
                    <label class="radio_button" for="confidence6">
                        <span class="confidence_number">6</span>
                        <input type="radio" id="confidence6" name="confidence" value="6">
                    </label>
                    <label class="radio_button" for="confidence7">
                        <span class="confidence_number">7</span>
                        <input type="radio" id="confidence7" name="confidence" value="7">
                    </label>
                    <label class="radio_button" for="confidence8">
                        <span class="confidence_number">8</span>
                        <input type="radio" id="confidence8" name="confidence" value="8">
                    </label>
                    <label class="radio_button" for="confidence9">
                        <span class="confidence_number">9</span>
                        <input type="radio" id="confidence9" name="confidence" value="9">
                    </label>
                    <label class="radio_button" for="confidence10">
                        <span class="confidence_number">10</span>
                        <input type="radio" id="confidence10" name="confidence" value="10">
                    </label>
                    <p>very confident</p>
                </div>
                <button onclick="closeExplanation()">Click here when you're done</button>
            </div>
        </div>
    </body>

    <script>
        /*
        var participantGroup = Math.floor(Math.random() * 2) + 1;
        var ready;
        if(participantGroup == 1) {
            document.getElementById("group1Explanation").style.display = "block";
            document.getElementById("tutorial").style.display = "flex";
            document.getElementById("confidence").style.display = "flex";
            ready = true;
        } else {
            document.getElementById("group2Explanation").style.display = "block";
            document.getElementById("tutorial").style.display = "flex";
            ready = false;
        }

        function setConfidence() {
            var rates = document.getElementsByName("confidence");
            var confidenceValue;
            for(var i = 0; i < rates.length; i++) {
                if(rates[i].checked) {
                    confidenceValue = rates[i].value;
                }
            }
            document.getElementById("surveyLink").href = "https://docs.google.com/forms/d/e/1FAIpQLSfa0Nt08lBclw7pM523cVVIdbdM2qIqvwJjWpevGgleaQ_FtQ/viewform?usp=pp_url&entry.755563979=" + participantGroup + "&entry.146232743=" + confidenceValue;
        }

        function closeExplanation() {
            document.getElementById("explanation").style.display = "none";
            if(!ready) {
                lineSegments.forEach(line => {
                    line.filled = true;
                });
                gameWindow.startCursorCheck();
                window.setTimeout(function(){
                    document.body.style.cursor = "default";
                    window.clearInterval(gameWindow.cursorCheck);
                    document.getElementById("tutorial").style.display = "none";
                    document.getElementById("group2Explanation").style.display = "none";
                    document.getElementById("explanation").style.display = "block";
                    document.getElementById("group2Explanation2").style.display = "block";
                    document.getElementById("confidence").style.display = "flex";
                    ready = true;
                }, 15000);
            } else {
                startGame();
            }
            updateGameArea();
        }
        */


        function startTutorial() {
            gameWindow.start();
            window.requestAnimationFrame(gameWindow.draw);
            var playerCharacter = new PlayerCharacter();
            var enemy = new Enemy("wizard", {x:231, y:190}, {x:400, y:400});
            drawTextBox("this is a super long string that might fill more than the screen, especially if i keep adding dumb stuff like this and that, fuck still not long enough gotta keep going until i can't anymore and then keep going anyway. Somehow this wasn't enough so now i gotta add even more text just to try and fill out the stupid ass box");
            gameWindow.context2.drawImage(document.getElementById("map2Image"), 0, 0);
            highlightArea(function() {gameWindow.context3.arc(200, 200, 100, 0, 2 * Math.PI)});
        }

        function startPractice() {

        }

        function prepareGame() {
            
        }

        function startGame() {
            
        }

        var drawables = {};
        var gameWindow = {
            stopGame : false,
            canvas1 : document.getElementById("canvas1"),
            context1 : this.canvas1.getContext("2d"),
            canvas2 : document.getElementById("canvas2"),
            context2 : this.canvas2.getContext("2d"),
            canvas3 : document.getElementById("canvas3"),
            context3 : this.canvas3.getContext("2d"),

            start : function() {
                window.addEventListener('mousemove', function(e) {
                    var canvasRect = gameWindow.canvas1.getBoundingClientRect();
                    gameWindow.mouseX = e.clientX - canvasRect.left;
                    gameWindow.mouseY = e.clientY - canvasRect.top;
                });
            },

            draw : function() {
                if (gameWindow.stopGame) {
                    this.stopGame = false;
                    return;
                }
                gameWindow.context1.clearRect(0, 0, this.canvas1.width, this.canvas1.height);
                for (var key of Object.keys(drawables)) {
                    drawables[key].draw();
                }
                window.requestAnimationFrame(gameWindow.draw);
            }
        }

        function PlayerCharacter() {
            this.animationFrame = 0;
            this.frameSize = {x:231, y:190}
            this.size = {x:400, y:400}
            this.x = 100 - this.size.x / 2
            this.y = 300 - this.size.y / 2
            this.playerImage = document.getElementById("playerIdleImage");
            this.playerAttackImage = document.getElementById("playerAttackImage");
            drawables.player = new Animation(this.playerImage, this.x, this.y, this.frameSize, this.size, Infinity, "player");

            this.attack = function() {
                animation = getAnimation(new Animation(this.playerImage, this.x, this.y, this.frameSize, this.size, Infinity, "player"));
                drawables.player = new Animation(this.playerAttackImage, this.x, this.y, this.frameSize, this.size, 1, "player", animation);
            }
        }

        function Enemy(name, frameSize, size) {
            this.animationFrame = 0;
            this.frameSize = frameSize;
            this.size = size;
            this.x = 1100 - this.size.x / 2;
            this.y = 300 - this.size.y / 2;
            this.idleImage = document.getElementById(name + "IdleImage");
            this.attackImage = document.getElementById(name + "AttackImage");
            drawables.enemy = new Animation(this.idleImage, this.x, this.y, this.frameSize, this.size, Infinity, "enemy");
        }

        function getAnimation(animation) {
            return function() {
                drawables[animation.key] = animation;
            };
        }

        function Animation(image, x, y, frameSize, size, cycles, key, callBack) {
            this.image = image;
            this.x = x;
            this.y = y;
            this.frameSize = frameSize;
            this.size = size;
            this.animationFrame = 0;
            this.cycles = cycles;
            this.currentCycle = 0;
            this.key = key;
            this.callBack = callBack;
        
            this.draw = function() {
                //drawImage(image, dx, dy, dxWidth, dyHeight, x, y, xWidth, yHeight)
                gameWindow.context1.drawImage(this.image, this.frameSize.x * Math.floor(this.animationFrame / 6), 0, this.frameSize.x, this.frameSize.y, this.x, this.y, this.size.x, this.size.y);
                this.animationFrame++;
                if (this.animationFrame > this.image.width / this.frameSize.x * 6 - 1) {
                    this.animationFrame = 0;
                    this.currentCycle++;
                }
                if (this.currentCycle >= this.cycles) {
                    delete drawables[key];
                    if (this.callBack != undefined) {
                        this.callBack();
                    }
                }
            }
        }

        function highlightArea(area) {
            var ctx = gameWindow.context3;
            ctx.fillStyle = "rgba(0, 0, 0, 0.6)";
            ctx.beginPath();
            area();
            ctx.rect(1200, 0, -1200, 450);
            ctx.fill();
        }

        function drawTextBox(text) {
            var ctx = gameWindow.context2;
            ctx.font = "15px Arial";
            var lines = wrapText(ctx, text, 1100)
            ctx.fillStyle = "grey";
            ctx.beginPath();
            ctx.rect(0, 450, 1200, 150);
            ctx.fill();
            ctx.fillStyle = "white";
            var textY = 480;
            lines.forEach(line => {
                ctx.fillText(line, 50, textY);
                textY += 20;
            });
        }

        function wrapText(ctx, text, maxWidth) {
            var words = text.split(" ");
            var lines = [];
            var currentLine = words[0];

            for (var i = 1; i < words.length; i++) {
                var word = words[i];
                var width = ctx.measureText(currentLine + " " + word).width;
                if (width < maxWidth) {
                    currentLine += " " + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        
        
    </script>
</html>
